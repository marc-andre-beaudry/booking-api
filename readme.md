Campsite Booking Api
====================

The requirements for this API can be found [here](requirements.md)

## Technical details (non exhaustive)

- [Java 16](https://docs.oracle.com/en/java/javase/16/docs/api/index.html)
- [Spring Boot](https://spring.io/projects/spring-boot) with REST APIs using Spring MVC
- [Spring JPA](https://spring.io/projects/spring-data-jpa)
- [Postgres](https://www.postgresql.org/)
- [Liquibase](https://www.liquibase.org/)
- [Lombok](https://projectlombok.org/)
- [Testcontainers](https://www.testcontainers.org/)
    - Pre-requisite is [Docker](https://www.docker.com/)

## Assumptions

- Limited time, so production readiness of the App will lack some aspect. For example 'env' specific properties or
  leverage spring cloud config is not in scope for this project.

## Getting Started

This application is a typical spring boot application. To start simply run / run-as-debug
the ``CampsiteBookingApplication`` from your IDE. You can also run the application from the command line terminal
using ``gradle bootRun`` (or ``gradlew bootRun`` on Windows)

Application will start and expose the API documentation page on ``http://localhost:8080/swagger-ui.html`` by default.

## Auto code formatting with [Spotless](https://github.com/diffplug/spotless)
```
gradle spotlessApply
```

## Notes / Comments / Prod readiness

### Caching
- Caching done with caffeine cache, in real env should use Redis / Hazelcast / etc.

### Actuator
- It should be secured + proper role to access admin operations
- Maybe add secured managed operations for

### Tracing
- Trace for important code paths

### Booking IDs
- We could use a uuid generation module on Postgres to have it auto-generated by the DB instead.
- Could have used UUID postgres type instead of varchar 

### Find available dates within range

`:startDate` and `:endDate` are the parameters 

```
SELECT d::date 
  FROM generate_series(
    :startDate::timestamp without time zone,
    :endDate::timestamp without time zone,
    '1 day') AS gs(d) 
  WHERE NOT EXISTS(SELECT FROM bookings WHERE bookings.date_range @> d::date)
```
